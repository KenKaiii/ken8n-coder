# ken8n-workflows

This directory contains n8n workflow JSON files generated by ken8n-coder with advanced validation capabilities.

## Location

üìç **Project/ken8n-workflows/** - Workflows stored within the project directory

## Purpose

- **Default output location** for all n8n workflows created by the AI agent
- **Organized workflow management** - All workflows in one convenient place
- **Security compliance** - Agent can only write to project directory
- **Advanced validation** - Comprehensive Super Code node and n8n compatibility checking

## Enhanced Validation System

### üîç Validation Features

Our enhanced `validate.js` provides comprehensive validation for Super Code nodes and n8n workflows:

#### **Super Code Node Validation**
- ‚úÖ **Library Usage Analysis** - Detects and validates usage of available libraries
- ‚úÖ **n8n Context Validation** - Validates `$input`, `$node`, `$workflow` usage patterns
- ‚úÖ **Return Structure Validation** - Ensures proper `[{json: {...}}]` format
- ‚úÖ **Execution Simulation** - Tests code execution in mock n8n environment
- ‚úÖ **Performance Checks** - Detects infinite loops, blocking operations, memory issues
- ‚úÖ **Security Validation** - Prevents dangerous patterns like `require()`, `eval()`

#### **Workflow-Level Validation**
- ‚úÖ **Connection Validation** - Verifies all node connections exist and are valid
- ‚úÖ **Data Flow Analysis** - Ensures proper workflow structure and termination
- ‚úÖ **n8n Compatibility** - Validates JSON structure for successful n8n import
- ‚úÖ **Node Structure** - Checks required fields (ID, name, type, position)
- ‚úÖ **Metadata Validation** - Validates n8n-specific metadata and version info

### üöÄ Usage

#### Basic Validation
```bash
node validate.js my-workflow.json
```

#### Advanced Validation (Default)
```bash
# Includes execution simulation and comprehensive checks
node validate.js my-workflow.json
```

#### Test Suite
```bash
# Run comprehensive validation tests
node test-validation.js
```

### üìä Validation Levels

1. **Basic Validation** - JSON structure, syntax, required fields
2. **Advanced Validation** - Library usage, data flow, n8n compatibility  
3. **Execution Validation** - Code simulation in mock n8n environment

### üõ°Ô∏è Security & Performance Checks

The validator automatically detects:
- Hardcoded credentials (passwords, API keys)
- Dangerous code patterns (`require()`, `import`, `eval()`)
- Infinite loops and blocking operations
- Memory-intensive operations
- Missing error handling
- Improper return structures

### üîß Configuration

Validation can be customized with options:

```javascript
import { validateWorkflow } from './validate.js'

// Custom validation configuration
const result = validateWorkflow('my-workflow.json', {
  enableAdvancedValidation: true,  // Enable advanced checks
  validateExecution: true,         // Enable execution simulation
  maxExecutionTime: 5000,         // 5 second timeout
  maxCodeLength: 50000            // 50KB max code size
})
```

## Super Code Node Best Practices

### ‚úÖ Recommended Patterns

```javascript
// ‚úÖ Good: Proper n8n return format
return [{
  json: {
    result: processedData,
    status: 'success'
  }
}]

// ‚úÖ Good: Use global libraries
const processedData = lodash.map(inputData, item => ({
  ...item,
  timestamp: dayjs().toISOString()
}))

// ‚úÖ Good: Proper error handling
try {
  const result = processData($input.all())
  return [{ json: { success: true, data: result } }]
} catch (error) {
  return [{ json: { success: false, error: error.message } }]
}
```

### ‚ùå Patterns to Avoid

```javascript
// ‚ùå Bad: Using require/import
const fs = require('fs')        // Will fail in n8n
import axios from 'axios'       // Will fail in n8n

// ‚ùå Bad: Wrong return format  
return processedData            // Should be wrapped in array
return { json: data }           // Missing array wrapper

// ‚ùå Bad: Infinite loops
while(true) {                   // Will timeout/crash
  // processing
}
```

## File Naming Convention

- Use descriptive names: `api-data-processing.json`
- Include the main function: `email-automation-workflow.json`
- Avoid spaces, use hyphens: `csv-to-database-sync.json`

## Available Libraries

The Super Code node includes 46+ pre-loaded libraries:
- **Data Processing**: lodash, remeda, papaparse
- **Date/Time**: dayjs, moment, date-fns
- **HTTP**: axios, qs, FormData
- **Validation**: joi, yup, validator, Ajv
- **Crypto**: CryptoJS, bcrypt, jwt
- **Files**: XLSX, pdfLib, archiver, Jimp
- **And many more...**

## Getting Started

Ask ken8n-coder to create workflows like:

- "Create a webhook that processes CSV data"
- "Build an email notification workflow" 
- "Make an API integration workflow"

All workflows will be automatically validated and saved to this directory!

## Moving to Desktop (Optional)

Users can manually copy workflows to ~/Desktop/ken8n-workflows/ for easier access:

```bash
cp ken8n-workflows/*.json ~/Desktop/ken8n-workflows/
```

## Troubleshooting

### Common Validation Warnings

- **Library Usage Warning**: Ensure libraries are available in your n8n Super Code node
- **Return Format Warning**: Use `return [{json: {...}}]` format
- **Connection Warning**: Check all node connections are properly configured
- **Missing Fields Warning**: Add required n8n metadata fields

### Validation Errors

- **Syntax Errors**: Fix JavaScript syntax issues
- **Missing Fields**: Add required node properties (id, name, type)
- **Security Issues**: Remove `require()`, `import`, or hardcoded credentials
- **Connection Errors**: Ensure all referenced nodes exist

Run `node test-validation.js` for comprehensive examples and testing.
